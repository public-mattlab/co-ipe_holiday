<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Costume Tracker</title>
    <style>
        :root { --santa-red: #d42426; --elf-green: #2f5233; --gold: #ffd700; }
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: white; width: 100%; max-width: 600px; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* Podium Styles */
        .podium-section { display: flex; justify-content: space-around; gap: 15px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px dashed #ddd; }
        .podium-card { flex: 1; text-align: center; padding: 15px; border-radius: 15px; position: relative; color: white; }
        .santa-card { background: var(--santa-red); border: 4px solid var(--gold); }
        .elf-card { background: var(--elf-green); }
        .role-label { font-weight: bold; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
        .podium-names { font-size: 1.2rem; font-weight: bold; }
        .emoji { font-size: 2.5rem; display: block; margin-bottom: 5px; }

        /* Controls */
        .admin-controls { display: flex; gap: 10px; margin-bottom: 20px; }
        .top-bar { display: flex; justify-content: space-between; width: 100%; max-width: 600px; margin-bottom: 10px; }
        input[type="text"] { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 8px; outline: none; }
        button { background: var(--elf-green); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        .view-btn { background: #666; font-size: 0.8rem; }
        .download-btn { background: #1d6f42; font-size: 0.8rem; }

        /* List Styles */
        .list-item { display: flex; align-items: center; padding: 15px; background: #f9f9f9; margin-bottom: 8px; border-radius: 10px; }
        .rank { width: 30px; font-weight: bold; color: #888; }
        .name { flex: 1; font-weight: 600; font-size: 1.1rem; }
        .vote-input { width: 60px; padding: 8px; border: 1px solid #ccc; border-radius: 5px; text-align: center; margin-right: 10px; }
        .del-btn { background: none; color: #ff4d4d; font-size: 1.5rem; padding: 0 10px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="top-bar">
    <button class="view-btn" onclick="toggleAdmin()">Toggle Edit Mode</button>
    <button class="download-btn" onclick="downloadExcel()">üì• Download Excel (CSV)</button>
</div>

<div class="container">
    <div class="podium-section" id="podium">
        <div class="podium-card santa-card">
            <span class="role-label">Santa Costume</span>
            <span class="emoji">üéÖ</span>
            <div id="santaName" class="podium-names">---</div>
        </div>
        <div class="podium-card elf-card">
            <span class="role-label">Elf Costume</span>
            <span class="emoji">üßù</span>
            <div id="elfNames" class="podium-names">---</div>
        </div>
    </div>

    <div class="admin-controls admin-ui">
        <input type="text" id="nameInput" placeholder="Enter name...">
        <button onclick="addPerson()">Add Person</button>
    </div>

    <div id="leaderboard"></div>
</div>

<script>
    let people = JSON.parse(localStorage.getItem('holidayTracker')) || [];
    let isAdmin = true;

    function toggleAdmin() {
        isAdmin = !isAdmin;
        document.querySelectorAll('.admin-ui').forEach(el => el.classList.toggle('hidden'));
        render();
    }

    function addPerson() {
        const input = document.getElementById('nameInput');
        if (input.value.trim()) {
            people.push({ id: Date.now(), name: input.value.trim(), votes: 0 });
            input.value = '';
            saveAndRender();
        }
    }

    function updateVote(id, val) {
        const person = people.find(p => p.id === id);
        if (person) {
            person.votes = parseInt(val) || 0;
            saveAndRender();
        }
    }

    function deletePerson(id) {
        if(confirm("Remove this person?")) {
            people = people.filter(p => p.id !== id);
            saveAndRender();
        }
    }

    function downloadExcel() {
        if (people.length === 0) return alert("No data to download!");

        // Prepare CSV Content
        let csvContent = "Rank,Name,Votes,Role\n";
        
        const maxVotes = Math.max(...people.map(p => p.votes));
        const minVotes = Math.min(...people.map(p => p.votes));

        people.forEach((p, index) => {
            let role = "";
            if (p.votes === maxVotes) role = "Santa";
            else if (p.votes === minVotes) role = "Elf";
            
            csvContent += `${index + 1},${p.name},${p.votes},${role}\n`;
        });

        // Create download link
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.setAttribute("href", url);
        link.setAttribute("download", `costume_tracker_${new Date().toLocaleDateString()}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function saveAndRender() {
        people.sort((a, b) => b.votes - a.votes);
        localStorage.setItem('holidayTracker', JSON.stringify(people));
        render();
    }

    function render() {
        const santaNameDiv = document.getElementById('santaName');
        const elfNamesDiv = document.getElementById('elfNames');
        const listDiv = document.getElementById('leaderboard');

        if (people.length === 0) {
            listDiv.innerHTML = "<p style='text-align:center'>Add some names to begin!</p>";
            santaNameDiv.innerText = "---";
            elfNamesDiv.innerText = "---";
            return;
        }

        const maxVotes = people[0].votes;
        const minVotes = people[people.length - 1].votes;

        // Santa logic
        const santas = people.filter(p => p.votes === maxVotes).map(p => p.name);
        santaNameDiv.innerText = santas.join(", ");

        // Elf logic (Handles multiple)
        const elves = people.filter(p => p.votes === minVotes).map(p => p.name);
        elfNamesDiv.innerText = elves.join(", ");

        listDiv.innerHTML = '';
        people.forEach((person, index) => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `
                <div class="rank">${index + 1}</div>
                <div class="name">${person.name}</div>
                <input type="number" class="vote-input admin-ui ${!isAdmin ? 'hidden' : ''}" 
                       value="${person.votes}" 
                       onchange="updateVote(${person.id}, this.value)">
                <div class="vote-display ${isAdmin ? 'hidden' : ''}"><strong>${person.votes}</strong> votes</div>
                <button class="del-btn admin-ui ${!isAdmin ? 'hidden' : ''}" 
                        onclick="deletePerson(${person.id})">&times;</button>
            `;
            listDiv.appendChild(item);
        });
    }

    saveAndRender();
</script>

</body>
</html>
